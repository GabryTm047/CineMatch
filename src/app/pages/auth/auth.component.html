<section class="auth-wrapper">
  <div class="brand">
    <div class="brand-banner">
      <img src="assets/imgs/CineMatch_banner.JPG" alt="CineMatch banner" />
    </div>
  </div>

  <div class="auth-card">
    <header class="auth-header">
      @if (registerMode) {
        <h2>Crea il tuo profilo</h2>
        <p>Registra un account per salvare le preferenze dei tuoi film preferiti.</p>
      } @else {
        <h2>Bentornato!</h2>
        <p>Effettua il login per visualizzare i film selezionati apposta per te.</p>
      }

      <button type="button" class="toggle" (click)="toggleMode()">
        @if (registerMode) {
          Hai gi√† un account? <span>Accedi</span>
        } @else {
          Sei nuovo qui? <span>Registrati</span>
        }
      </button>
    </header>

    @if (errorMessage(); as error) {
      <div class="alert alert-error">{{ error }}</div>
    }

    @if (infoMessage(); as info) {
      <div class="alert alert-info">{{ info }}</div>
    }

    <form
      class="auth-form"
      [formGroup]="registerMode ? registerForm : loginForm"
      (ngSubmit)="submit()"
      novalidate
    >
      @if (registerMode) {
        <div class="form-field">
          <label for="name">Nome</label>
          <input
            id="name"
            type="text"
            maxlength="40"
            placeholder="Es. Gabriele"
            formControlName="name"
            [class.invalid]="registerControls.name.touched && registerControls.name.invalid"
          />
          @if (registerControls.name.touched && registerControls.name.invalid) {
            <span class="field-error"> Inserisci almeno 2 caratteri. </span>
          }
        </div>
      }

      <div class="form-field">
        <label for="email">Email</label>
        <input
          id="email"
          type="email"
          placeholder="tuamail@esempio.com"
          formControlName="email"
          [class.invalid]="
            registerMode
              ? registerControls.email.touched && registerControls.email.invalid
              : loginControls.email.touched && loginControls.email.invalid
          "
        />
        @if (registerMode && registerControls.email.touched && registerControls.email.invalid) {
          <span class="field-error"> Inserisci un indirizzo email valido. </span>
        }
        @if (!registerMode && loginControls.email.touched && loginControls.email.invalid) {
          <span class="field-error"> Indica la tua email per accedere. </span>
        }
      </div>

      <div class="form-field">
        <label for="password">Password</label>
        <input
          id="password"
          type="password"
          placeholder="Almeno 6 caratteri"
          formControlName="password"
          [class.invalid]="
            registerMode
              ? registerControls.password.touched && registerControls.password.invalid
              : loginControls.password.touched && loginControls.password.invalid
          "
        />
        @if (registerMode && registerControls.password.touched && registerControls.password.invalid) {
          <span class="field-error"> La password deve avere almeno 6 caratteri. </span>
        }
        @if (!registerMode && loginControls.password.touched && loginControls.password.invalid) {
          <span class="field-error"> Inserisci la tua password. </span>
        }
      </div>

      @if (registerMode) {
        <div class="form-field">
          <label for="confirmPassword">Conferma password</label>
          <input
            id="confirmPassword"
            type="password"
            placeholder="Ripeti la password"
            formControlName="confirmPassword"
            [class.invalid]="
              registerControls.confirmPassword.touched &&
              (registerControls.confirmPassword.invalid || registerForm.hasError('mismatch'))
            "
          />
          @if (
            registerControls.confirmPassword.touched &&
            (registerControls.confirmPassword.invalid || registerForm.hasError('mismatch'))
          ) {
            <span class="field-error"> Le password devono coincidere. </span>
          }
        </div>
      }

      <div class="actions">
        <button type="submit" class="primary">
          {{ registerMode ? 'Registrati' : 'Accedi' }}
        </button>
        <button type="button" class="ghost" (click)="continueAsGuest()">Entra come ospite</button>
        <button type="button" class="ghost with-icon" (click)="continueWithGoogle()">
          <img src="assets/imgs/google.svg" alt="Google" class="icon" />
          <span>Continua con Google</span>
        </button>
      </div>
    </form>
  </div>
</section>
